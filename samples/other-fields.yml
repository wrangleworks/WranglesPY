import:
  type: file
  name: "{{inputFile}}"
  sheet: 'Inventory tbl'

wrangles:
  - rename:
      input: LongText Refined
      output: Refined Description

  - rename:
      input: LongText Refined - Translated (EN)
      output: Refined Description (Translated)

  # Attributes + Properties
  - concatenate:
      input:
        - LongText
        - Purchase Order Text
      output: Desc for Attributes
      parameters:
        char: ' || placeholder || '
  - extract.attributes:
      input: Desc for Attributes
      output: Attributes

  - extract.properties:
      input: LongText Refined - Translated (EN)
      output: Properties

  # Noun
  # - classify:
  #     input: 'Desc - Refined'
  #     output: Noun (Desc)
  #     parameters:
  #       model_id: f59d7523-0096-43e2

  - split:
      input: Noun (Desc)
      output: Noun (Desc)
      parameters:
        char: ' || '

  - split:
      input: Noun (Class)
      output: Noun (Class)
      parameters:
        char: ' || '

  - select.highest_confidence:
      input:
        - Noun (Desc)
        - Noun (Class)
      output: Noun (Blend)

  - classify:
      input: LongText Refined - Translated (EN)
      output: Noun (Token)
      parameters:
        model_id: c77839db-237a-476b

  - select.threshold:
      input:
        - Noun (Blend)
        - Noun (Token)
      output: Noun
      parameters:
        threshold: 0.8
    
  # Commodity
  - classify:
      input: LongText Refined - Translated (EN)
      output: Commodity (Desc)
      parameters:
        model_id: 24ac9037-ecab-4030
  - split:
      input: Commodity (Desc)
      output: Commodity (Desc)
      parameters:
        char: ' || '

  - classify:
      input: Noun
      output: Commodity (Noun)
      parameters:
        model_id: 24ac9037-ecab-4030
  - split:
      input: Commodity (Noun)
      output: Commodity (Noun)
      parameters:
        char: ' || '

  - classify:
      input: Subclass
      output: Commodity (Class)
      parameters:
        model_id: 24ac9037-ecab-4030
  - split:
      input: Commodity (Class)
      output: Commodity (Class)
      parameters:
        char: ' || '

  - select.highest_confidence:
      input:
        - Commodity (Noun)
        - Commodity (Desc)
        - Commodity (Class)
      output: Commodity (Blend)

  - select.list_element:
      input: Commodity (Blend)
      output: Commodity
      parameters:
        element: 0
  
  - select.list_element:
      input: Commodity (Blend)
      output: Commodity (Confidence)
      parameters:
        element: 1
  - convert.data_type:
      input: Commodity (Confidence)
      output: Commodity (Confidence)
      parameters:
        dataType: float
    
  # UNSPSC
  - classify:
      input: LongText Refined - Translated (EN)
      output: UNSPSC (Desc)
      parameters:
        model_id: 7f4177d9-6690-4234
  - split:
      input: UNSPSC (Desc)
      output: UNSPSC (Desc)
      parameters:
        char: ' || '

  - classify:
      input: Noun
      output: UNSPSC (Noun)
      parameters:
        model_id: 7f4177d9-6690-4234
  - split:
      input: UNSPSC (Noun)
      output: UNSPSC (Noun)
      parameters:
        char: ' || '

  - classify:
      input: Subclass
      output: UNSPSC (Class)
      parameters:
        model_id: 7f4177d9-6690-4234
  - split:
      input: UNSPSC (Class)
      output: UNSPSC (Class)
      parameters:
        char: ' || '

  - select.highest_confidence:
      input:
        - UNSPSC (Noun)
        - UNSPSC (Desc)
        - UNSPSC (Class)
      output: UNSPSC (Blend)

  - select.list_element:
      input: UNSPSC (Blend)
      output: UNSPSC
      parameters:
        element: 0
  
  - select.list_element:
      input: UNSPSC (Blend)
      output: UNSPSC (Confidence)
      parameters:
        element: 1
  - convert.data_type:
      input: UNSPSC (Confidence)
      output: UNSPSC (Confidence)
      parameters:
        dataType: float

export:
  type: file
  name: "{{outputFile}}"
  fields:
    - ID
    - Refined Description
    - Refined Description (Translated)
    - Noun
    - Commodity
    - Commodity (Confidence)
    - UNSPSC
    - UNSPSC (Confidence)
    - Properties
    - Attributes